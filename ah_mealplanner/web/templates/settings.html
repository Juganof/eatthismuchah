{% extends "base.html" %}
{% block content %}
<h2>Settings</h2>
<form method="post">
  <div class="row">
    <label>Default Macronutrient Distribution (%)</label>
    <p class="muted">Set the default percentage of calories from each macronutrient. Used when auto-filling macros from a calorie target. Must add up to 100%.</p>
    <div class="grid" style="grid-template-columns: repeat(3, minmax(80px, 140px)); gap: 0.5rem; max-width: 460px;">
      <div>
        <label for="protein_pct">Protein (%)</label>
        <input type="number" id="protein_pct" name="protein_pct" value="{{ settings.p }}" min="0" max="100" step="1" required>
      </div>
      <div>
        <label for="carbs_pct">Carbs (%)</label>
        <input type="number" id="carbs_pct" name="carbs_pct" value="{{ settings.c }}" min="0" max="100" step="1" required>
      </div>
      <div>
        <label for="fat_pct">Fat (%)</label>
        <input type="number" id="fat_pct" name="fat_pct" value="{{ settings.f }}" min="0" max="100" step="1" required>
      </div>
    </div>
    <div id="pct-error" style="color: red; margin-top: 0.5rem; display: none;">
      Percentages must add up to 100.
    </div>
  </div>

  <div class="row">
    <label for="default_servings">Default Recipe Servings</label>
    <p class="muted">The default number of servings for recipes when generating a new meal plan.</p>
    <input type="number" id="default_servings" name="default_servings" value="{{ settings.servings }}" min="0.25" step="0.25" required>
  </div>

  <button class="btn" type="submit">Save Settings</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  const proteinInput = document.getElementById('protein_pct');
  const carbsInput = document.getElementById('carbs_pct');
  const fatInput = document.getElementById('fat_pct');
  const errorDiv = document.getElementById('pct-error');

  function validatePercentages() {
    const p = parseInt(proteinInput.value, 10) || 0;
    const c = parseInt(carbsInput.value, 10) || 0;
    const f = parseInt(fatInput.value, 10) || 0;

    if (p + c + f !== 100) {
      errorDiv.style.display = 'block';
      return false;
    } else {
      errorDiv.style.display = 'none';
      return true;
    }
  }

  form.addEventListener('submit', function(e) {
    if (!validatePercentages()) {
      e.preventDefault(); // Prevent form submission if validation fails
    }
  });

  proteinInput.addEventListener('input', validatePercentages);
  carbsInput.addEventListener('input', validatePercentages);
  fatInput.addEventListener('input', validatePercentages);

  // Initial validation check
  validatePercentages();
});
</script>
{% endblock %}